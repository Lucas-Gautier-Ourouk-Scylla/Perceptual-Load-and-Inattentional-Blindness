---
title: "Cleaning_Perceptual_Load"
author: "Lu-K Gautier"
date: '2022-11-14'
output: html_document
---

# Aim of the script

This script is the data cleaning for the project "IB_Perceptual_Load". This project explore the interaction between perceptual load and attentional setting in an sustained inattentional blindness task.


OSF link of this project is <https://osf.io/y7awc/> (preregistration is
available at <https://osf.io/grdca>)

```{r packages}

require(pacman)

p_load(dplyr, emmeans, tidyverse, readr, psych, lmerTest, ggplot2, kableExtra, rsq, questionr, TOSTER, sjPlot)


# df <- Initial_data <- read_csv("Raw_Data/data.csv")
# 
# df_Anonymous <- df %>%
#   mutate(PROLIFIC_PID = "####", 
#          SESSION_ID = "####")
# 
# write.csv(df_Anonymous, file = "Raw_Data/data_anonymous.csv")


df <- Initial_data <- read_csv("Raw_Data/data_anonymous.csv") %>%
    select(-"...1")

```

 # Renaming variables
 
- participant : Name of the participant data

- response_id : Participant number

## Experimental Conditions

PrimaryTask: Which instructions participants have to perform in terms of
words\
- WhiteFocus = Count bounces of Whites squares\
- BlackFocus = Count bounces of Black squares

PrimaryTask_C: Which instructions participants have to perform in terms
of code\
- -0.5 = White squares bounce counting condition\
- +0.5 = Black squares bounce counting condition


Congruency_C : Is the unexpected element congruent or incongruent with task settings in terms of words. **In this study, the Unexpected Element is Incongruent in each experimental condition**\
- -0.5 = The unexpected element is incongruent with task settings \
- +0.5 = The unexpected element is congruent with task settings \

Congruency_str : Is the unexpected element congruent or incongruent with task settings in terms of words. **In this study, the Unexpected Element is Incongruent in each experimental condition**\
- Incongruent = The unexpected element is incongruent with task settings \
- Congruent = The unexpected element is congruent with task settings \


Load_C : The perceptual load of the task (the number represent the number of targets as welle as the number of distractors. It means that the real number of stimuli on the screen is twice this number).
- 1 : 1 target and 1 distractor (2 stimuli on the screen)
- 2 : 2 targets and 2 distractors (4 stimuli on the screen)
- 3 : 3 targets and 3 distractors (6 stimuli on the screen)
- 4 : 4 targets and 4 distractors (8 stimuli on the screen) in the Incongruent condition
- 4 : 4 targets and 4 distractors (8 stimuli on the screen) in the Congruent condition
- 5 : 5 targets and 5 distractors (10 stimuli on the screen)
- 6 : 6 targets and 6 distractors (12 stimuli on the screen)
- 7 : 7 targets and 7 distractors (14 stimuli on the screen)
- 8 : 8 targets and 8 distractors (16 stimuli on the screen)


Load_str : The perceptual load of the task (the number represent the number of targets as welle as the number of distractors. It means that the real number of stimuli on the screen is twice this number).
- One : 1 target and 1 distractor (2 stimuli on the screen)
- Two : 2 targets and 2 distractors (4 stimuli on the screen)
- Three : 3 targets and 3 distractors (6 stimuli on the screen)
- Four_Incong : 4 targets and 4 distractors (8 stimuli on the screen) in the Incongruent condition
- Four_Cong : 4 targets and 4 distractors (8 stimuli on the screen) in the Congruent condition
- Five : 5 targets and 5 distractors (10 stimuli on the screen)
- Six : 6 targets and 6 distractors (12 stimuli on the screen)
- Seven : 7 targets and 7 distractors (14 stimuli on the screen)
- Eight : 8 targets and 8 distractors (16 stimuli on the screen)


## Noticing

Noticing_Critic: If participant report having seen something during the
critical trial and report at least one characteristic of unexpected
elements (color, feature, motion)\
- 0 = Non noticer\
- 1 = Noticer who report at least one good feature of the unexpected
element

Noticing_Divided: If participant report having seen something during the
Divided attention trial and report at least one characteristic of unexpected
elements (color, feature, motion)\
- 0 = Non noticer\
- 1 = Noticer who report at least one good feature of the unexpected
element

Noticing_Full: If participant report having seen something during the
Full attention trial and report at least one characteristic of unexpected
elements (color, feature, motion)\
- 0 = Non noticer\
- 1 = Noticer who report at least one good feature of the unexpected
element


## Bounce-counting performance

Count_Trial1: Number of bounces counted during Trial1

Count_Trial2: Number of bounces counted during Trial2

Count_Trial3: Number of bounces counted during Trial3

Count_Trial4: Number of bounces counted during Trial4

Count_TrialCritical: Number of bounces counted during Critical Trial

Count_TrialDivided: Number of bounces counted during Divided Attention
Trial

Error_Trial1: absolute value of the difference between the real number
of bounce and what the participant reports for Trial 1

ErrorRate_Trial1: Error Rate for Trial 1 (=absolute value of the difference between the real number
of bounce and what the participant reports, divided by the total number of bounces)


Error_Trial2: absolute value of the difference between the real number
of bounce and what the participant reports for Trial 2

ErrorRate_Trial2: Error Rate for Trial 2 (=absolute value of the difference between the real number
of bounce and what the participant reports, divided by the total number of bounces)


Error_Trial3: absolute value of the difference between the real number
of bounce and what the participant reports for Trial 3

ErrorRate_Trial3: Error Rate for Trial 3 (=absolute value of the difference between the real number
of bounce and what the participant reports, divided by the total number of bounces)


Error_Trial4: absolute value of the difference between the real number
of bounce and what the participant reports for Trial 4

ErrorRate_Trial4: Error Rate for Trial 4 (=absolute value of the difference between the real number
of bounce and what the participant reports, divided by the total number of bounces)


Error_TrialCritic: absolute value of the difference between the real
number of bounce and what the participant reports for the Critical Trial

ErrorRate_TrialCritic: Error Rate for the critical trial


Error_TrialDivided: absolute value of the difference between the real
number of bounce and what the participant reports for the Divided
Attention Trial

ErrorRate_TrialDivided: Error Rate for the divided trial


### Anxiety scale 

Participants answers on the anxiety scale after the IB task:
    - Angry: Participant answer on the angry item from the anxiety scale ("I currently feel angry"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Anxious: Participant answer on the anxious item from the anxiety scale ("I currently feel anxious"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Happy: Participant answer on the happy item from the anxiety scale ("I currently feel happy"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Depressed: Participant answer on the depressed item from the anxiety scale ("I'm currently feeling depressed"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Tense: Participant answer on the tense item from the anxiety scale ("I'm currently feeling tense"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Calm: Participant answer on the calm item from the anxiety scale ("I'm currently feeling calm"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Stressed: Participant answer on the stressed item from the anxiety scale ("I feel stressed at the moment"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    - Nervous: Participant answer on the nervous item from the anxiety scale ("I'm currently feeling nervous"). Responses on a 7-likert scale, from 1 = "Not at all" to 7 = "Extremely".
    
    
FearScore: A factorial composite score of 4 anxiety items (Tense,
Anxious, Nervous, Stressed) measured after the experimental induction, using a Bartlett method

FearMean: A composite score of 4 anxiety items (Tense, Anxious, Tense,
Stressed) after the experimental induction, using a mean calculation rather than a factorial score



## Exclusion variables

VisionPb_str: Did participants report having vision problems (not corrected) during the experiment (Word variable coding)
- No = Participant reports not having any vision problem\
- Yes = Participant reports having vision problems\

VisionPb: Did participants report having vision problems (not corrected) during the experiment (Contrast variable coding)
- -0.5 = Participant reports not having any prior expectations\
- +0.5 = Participant reports having prior expectations\


Knew: If participants have already done exactly the same task as this
dynamic inattentional blindness task\
- -0.5 = Never made exactly this task\
- +0.5 = Ever made exactly this task

Knew_str: If participants have already done exactly the same task as this
dynamic inattentional blindness task\
- No = Never made exactly this task\
- Yes = Ever made exactly this task

KnewTask: If participants have already done a similar task but not
exactly the same one\
- -0.5 = No task knowledge\
- +0.5 = Task knowledge

KnewTask_str: If participants have already done a similar task but not
exactly the same one\
- No = No task knowledge\
- Yes = Task knowledge

KnewIB: If participants knew the inattentional blindness phenomenon
before to run the experiment\
- -0.5 = No IB knowledge\
- +0.5 = IB knowledge

KnewIB_str: If participants knew the inattentional blindness phenomenon
before to run the experiment\
- No = No IB knowledge\
- Yes = IB knowledge

## Demographics

Age: Participant self rating on age

Gender: Participant gender self identification\
- 1 = Woman self identification\
- 2 = Man self identification\
- 3 = None of these

Gender_str: Participant gender self identification\
- Woman = Woman self identification\
- Man = Man self identification\
- NoBinary = None of these


```{r read}

tmp <- df

names(tmp)[1] <- "participant"
names(tmp)[2] <- "Chooserandom_Instruction"
names(tmp)[3] <- "Chooserandom_Condition"

tmp <- tmp %>% 
  mutate(response_id = row_number())

names(tmp)[4] <- "Trial1_C1"
names(tmp)[5] <- "Trial2_C1"
names(tmp)[6] <- "Trial3_C1"
names(tmp)[7] <- "Trial_Critic_C1"
names(tmp)[8] <- "IB_Critic_C1"
names(tmp)[9] <- "Feature_Critic_C1"
names(tmp)[10] <- "Color_Critic_C1"
names(tmp)[11] <- "Motion_Critic_C1"
names(tmp)[12] <- "Trial4_C1"
names(tmp)[13] <- "Trial_Divided_C1"
names(tmp)[14] <- "IB_Divided_C1"
names(tmp)[15] <- "Feature_Divided_C1"
names(tmp)[16] <- "Color_Divided_C1"
names(tmp)[17] <- "Motion_Divided_C1"
names(tmp)[18] <- "IB_Full_C1"
names(tmp)[19] <- "Feature_Full_C1"
names(tmp)[20] <- "Color_Full_C1"
names(tmp)[21] <- "Motion_Full_C1"


names(tmp)[22] <- "Trial1_C2"
names(tmp)[23] <- "Trial2_C2"
names(tmp)[24] <- "Trial3_C2"
names(tmp)[25] <- "Trial_Critic_C2"
names(tmp)[26] <- "IB_Critic_C2"
names(tmp)[27] <- "Feature_Critic_C2"
names(tmp)[28] <- "Color_Critic_C2"
names(tmp)[29] <- "Motion_Critic_C2"
names(tmp)[30] <- "Trial4_C2"
names(tmp)[31] <- "Trial_Divided_C2"
names(tmp)[32] <- "IB_Divided_C2"
names(tmp)[33] <- "Feature_Divided_C2"
names(tmp)[34] <- "Color_Divided_C2"
names(tmp)[35] <- "Motion_Divided_C2"
names(tmp)[36] <- "IB_Full_C2"
names(tmp)[37] <- "Feature_Full_C2"
names(tmp)[38] <- "Color_Full_C2"
names(tmp)[39] <- "Motion_Full_C2"


names(tmp)[40] <- "Trial1_C3"
names(tmp)[41] <- "Trial2_C3"
names(tmp)[42] <- "Trial3_C3"
names(tmp)[43] <- "Trial_Critic_C3"
names(tmp)[44] <- "IB_Critic_C3"
names(tmp)[45] <- "Feature_Critic_C3"
names(tmp)[46] <- "Color_Critic_C3"
names(tmp)[47] <- "Motion_Critic_C3"
names(tmp)[48] <- "Trial4_C3"
names(tmp)[49] <- "Trial_Divided_C3"
names(tmp)[50] <- "IB_Divided_C3"
names(tmp)[51] <- "Feature_Divided_C3"
names(tmp)[52] <- "Color_Divided_C3"
names(tmp)[53] <- "Motion_Divided_C3"
names(tmp)[54] <- "IB_Full_C3"
names(tmp)[55] <- "Feature_Full_C3"
names(tmp)[56] <- "Color_Full_C3"
names(tmp)[57] <- "Motion_Full_C3"

names(tmp)[58] <- "Trial1_C4_Incong"
names(tmp)[59] <- "Trial2_C4_Incong"
names(tmp)[60] <- "Trial3_C4_Incong"
names(tmp)[61] <- "Trial_Critic_C4_Incong"
names(tmp)[62] <- "IB_Critic_C4_Incong"
names(tmp)[63] <- "Feature_Critic_C4_Incong"
names(tmp)[64] <- "Color_Critic_C4_Incong"
names(tmp)[65] <- "Motion_Critic_C4_Incong"
names(tmp)[66] <- "Trial4_C4_Incong"
names(tmp)[67] <- "Trial_Divided_C4_Incong"
names(tmp)[68] <- "IB_Divided_C4_Incong"
names(tmp)[69] <- "Feature_Divided_C4_Incong"
names(tmp)[70] <- "Color_Divided_C4_Incong"
names(tmp)[71] <- "Motion_Divided_C4_Incong"
names(tmp)[72] <- "IB_Full_C4_Incong"
names(tmp)[73] <- "Feature_Full_C4_Incong"
names(tmp)[74] <- "Color_Full_C4_Incong"
names(tmp)[75] <- "Motion_Full_C4_Incong"


names(tmp)[76] <- "Trial1_C4_Cong"
names(tmp)[77] <- "Trial2_C4_Cong"
names(tmp)[78] <- "Trial3_C4_Cong"
names(tmp)[79] <- "Trial_Critic_C4_Cong"
names(tmp)[80] <- "IB_Critic_C4_Cong"
names(tmp)[81] <- "Feature_Critic_C4_Cong"
names(tmp)[82] <- "Color_Critic_C4_Cong"
names(tmp)[83] <- "Motion_Critic_C4_Cong"
names(tmp)[84] <- "Trial4_C4_Cong"
names(tmp)[85] <- "Trial_Divided_C4_Cong"
names(tmp)[86] <- "IB_Divided_C4_Cong"
names(tmp)[87] <- "Feature_Divided_C4_Cong"
names(tmp)[88] <- "Color_Divided_C4_Cong"
names(tmp)[89] <- "Motion_Divided_C4_Cong"
names(tmp)[90] <- "IB_Full_C4_Cong"
names(tmp)[91] <- "Feature_Full_C4_Cong"
names(tmp)[92] <- "Color_Full_C4_Cong"
names(tmp)[93] <- "Motion_Full_C4_Cong"


names(tmp)[94] <- "Trial1_C5"
names(tmp)[95] <- "Trial2_C5"
names(tmp)[96] <- "Trial3_C5"
names(tmp)[97] <- "Trial_Critic_C5"
names(tmp)[98] <- "IB_Critic_C5"
names(tmp)[99] <- "Feature_Critic_C5"
names(tmp)[100] <- "Color_Critic_C5"
names(tmp)[101] <- "Motion_Critic_C5"
names(tmp)[102] <- "Trial4_C5"
names(tmp)[103] <- "Trial_Divided_C5"
names(tmp)[104] <- "IB_Divided_C5"
names(tmp)[105] <- "Feature_Divided_C5"
names(tmp)[106] <- "Color_Divided_C5"
names(tmp)[107] <- "Motion_Divided_C5"
names(tmp)[108] <- "IB_Full_C5"
names(tmp)[109] <- "Feature_Full_C5"
names(tmp)[110] <- "Color_Full_C5"
names(tmp)[111] <- "Motion_Full_C5"


names(tmp)[112] <- "Trial1_C6"
names(tmp)[113] <- "Trial2_C6"
names(tmp)[114] <- "Trial3_C6"
names(tmp)[115] <- "Trial_Critic_C6"
names(tmp)[116] <- "IB_Critic_C6"
names(tmp)[117] <- "Feature_Critic_C6"
names(tmp)[118] <- "Color_Critic_C6"
names(tmp)[119] <- "Motion_Critic_C6"
names(tmp)[120] <- "Trial4_C6"
names(tmp)[121] <- "Trial_Divided_C6"
names(tmp)[122] <- "IB_Divided_C6"
names(tmp)[123] <- "Feature_Divided_C6"
names(tmp)[124] <- "Color_Divided_C6"
names(tmp)[125] <- "Motion_Divided_C6"
names(tmp)[126] <- "IB_Full_C6"
names(tmp)[127] <- "Feature_Full_C6"
names(tmp)[128] <- "Color_Full_C6"
names(tmp)[129] <- "Motion_Full_C6"


names(tmp)[130] <- "Trial1_C7"
names(tmp)[131] <- "Trial2_C7"
names(tmp)[132] <- "Trial3_C7"
names(tmp)[133] <- "Trial_Critic_C7"
names(tmp)[134] <- "IB_Critic_C7"
names(tmp)[135] <- "Feature_Critic_C7"
names(tmp)[136] <- "Color_Critic_C7"
names(tmp)[137] <- "Motion_Critic_C7"
names(tmp)[138] <- "Trial4_C7"
names(tmp)[139] <- "Trial_Divided_C7"
names(tmp)[140] <- "IB_Divided_C7"
names(tmp)[141] <- "Feature_Divided_C7"
names(tmp)[142] <- "Color_Divided_C7"
names(tmp)[143] <- "Motion_Divided_C7"
names(tmp)[144] <- "IB_Full_C7"
names(tmp)[145] <- "Feature_Full_C7"
names(tmp)[146] <- "Color_Full_C7"
names(tmp)[147] <- "Motion_Full_C7"


names(tmp)[148] <- "Trial1_C8"
names(tmp)[149] <- "Trial2_C8"
names(tmp)[150] <- "Trial3_C8"
names(tmp)[151] <- "Trial_Critic_C8"
names(tmp)[152] <- "IB_Critic_C8"
names(tmp)[153] <- "Feature_Critic_C8"
names(tmp)[154] <- "Color_Critic_C8"
names(tmp)[155] <- "Motion_Critic_C8"
names(tmp)[156] <- "Trial4_C8"
names(tmp)[157] <- "Trial_Divided_C8"
names(tmp)[158] <- "IB_Divided_C8"
names(tmp)[159] <- "Feature_Divided_C8"
names(tmp)[160] <- "Color_Divided_C8"
names(tmp)[161] <- "Motion_Divided_C8"
names(tmp)[162] <- "IB_Full_C8"
names(tmp)[163] <- "Feature_Full_C8"
names(tmp)[164] <- "Color_Full_C8"
names(tmp)[165] <- "Motion_Full_C8"



names(tmp)[166] <- "Angry"
names(tmp)[167] <- "Anxious"
names(tmp)[168] <- "Happy"
names(tmp)[169] <- "Depressed"
names(tmp)[170] <- "Tense"
names(tmp)[171] <- "Calm"
names(tmp)[172] <- "Stressed"
names(tmp)[173] <- "Nervous"
names(tmp)[174] <- "Vision_1"
names(tmp)[175] <- "Connaissance_1"
names(tmp)[176] <- "Connaissance_Task_1"
names(tmp)[177] <- "Connaissance_IB_1"
names(tmp)[178] <- "Age"
names(tmp)[179] <- "Gender"
names(tmp)[180] <- "PROLIFIC_PID"
names(tmp)[181] <- "STUDY_ID"
names(tmp)[182] <- "SESSION_ID"
names(tmp)[183] <- "TIME_start"
names(tmp)[184] <- "TIME_end"
names(tmp)[185] <- "TIME_total"

df <- tmp

rm(list=setdiff(ls(), c("df"))) # clear workspace except the data frame

```


 # Merge all these conditions (n=9) into one
 

```{r Merge}

tmp <- df

# Add the function coalesce2
coalesce2 <- function(...) {
  apply(cbind(...), 1, function(x) {
          x[which(!is.na(x))[1]]
        })
}

 # Build a unique column that contain the number of bounce counting in Trial 1 for all conditions
tmp <- tmp %>% 
  mutate(Count_Trial1 = case_when(Chooserandom_Condition == "1" ~ Trial1_C1,
                            Chooserandom_Condition == "2" ~ Trial1_C2,
                            Chooserandom_Condition == "3" ~ Trial1_C3,
                            Chooserandom_Condition == "41" ~ Trial1_C4_Incong,
                            Chooserandom_Condition == "42" ~ Trial1_C4_Cong,
                            Chooserandom_Condition == "5" ~ Trial1_C5,
                            Chooserandom_Condition == "6" ~ Trial1_C6,
                            Chooserandom_Condition == "7" ~ Trial1_C7,
                            Chooserandom_Condition == "8" ~ Trial1_C8))


 # Build a unique column that contain the number of bounce counting in Trial 2 for all conditions
tmp <- tmp %>% 
  mutate(Count_Trial2 = case_when(Chooserandom_Condition == "1" ~ Trial2_C1,
                            Chooserandom_Condition == "2" ~ Trial2_C2,
                            Chooserandom_Condition == "3" ~ Trial2_C3,
                            Chooserandom_Condition == "41" ~ Trial2_C4_Incong,
                            Chooserandom_Condition == "42" ~ Trial2_C4_Cong,
                            Chooserandom_Condition == "5" ~ Trial2_C5,
                            Chooserandom_Condition == "6" ~ Trial2_C6,
                            Chooserandom_Condition == "7" ~ Trial2_C7,
                            Chooserandom_Condition == "8" ~ Trial2_C8))


 # Build a unique column that contain the number of bounce counting in Trial 3 for all conditions
tmp <- tmp %>% 
  mutate(Count_Trial3 = case_when(Chooserandom_Condition == "1" ~ Trial3_C1,
                            Chooserandom_Condition == "2" ~ Trial3_C2,
                            Chooserandom_Condition == "3" ~ Trial3_C3,
                            Chooserandom_Condition == "41" ~ Trial3_C4_Incong,
                            Chooserandom_Condition == "42" ~ Trial3_C4_Cong,
                            Chooserandom_Condition == "5" ~ Trial3_C5,
                            Chooserandom_Condition == "6" ~ Trial3_C6,
                            Chooserandom_Condition == "7" ~ Trial3_C7,
                            Chooserandom_Condition == "8" ~ Trial3_C8))

 # Build a unique column that contain the number of bounce counting in Trial 4 for all conditions
tmp <- tmp %>% 
  mutate(Count_Trial4 = case_when(Chooserandom_Condition == "1" ~ Trial4_C1,
                            Chooserandom_Condition == "2" ~ Trial4_C2,
                            Chooserandom_Condition == "3" ~ Trial4_C3,
                            Chooserandom_Condition == "41" ~ Trial4_C4_Incong,
                            Chooserandom_Condition == "42" ~ Trial4_C4_Cong,
                            Chooserandom_Condition == "5" ~ Trial4_C5,
                            Chooserandom_Condition == "6" ~ Trial4_C6,
                            Chooserandom_Condition == "7" ~ Trial4_C7,
                            Chooserandom_Condition == "8" ~ Trial4_C8))


 # Build a unique column that contain the number of bounce counting in The critical trial for all conditions
tmp$Count_TrialCritical <- coalesce2(tmp$Trial_Critic_C1, 
                              tmp$Trial_Critic_C2, 
                              tmp$Trial_Critic_C3, 
                              tmp$Trial_Critic_C4_Incong, 
                              tmp$Trial_Critic_C4_Cong, 
                              tmp$Trial_Critic_C5, 
                              tmp$Trial_Critic_C6, 
                              tmp$Trial_Critic_C7, 
                              tmp$Trial_Critic_C8)


 # Build a unique column that contain the number of bounce counting in The Divided attention trial for all conditions
tmp$Count_TrialDivided <- coalesce2(tmp$Trial_Divided_C1, 
                              tmp$Trial_Divided_C2, 
                              tmp$Trial_Divided_C3, 
                              tmp$Trial_Divided_C4_Incong, 
                              tmp$Trial_Divided_C4_Cong, 
                              tmp$Trial_Divided_C5, 
                              tmp$Trial_Divided_C6, 
                              tmp$Trial_Divided_C7, 
                              tmp$Trial_Divided_C8)


 # Build a unique column that contain the detection of the unexpected element in the critical trial for all conditions
tmp$IB_Critic <- coalesce2(tmp$IB_Critic_C1, 
                           tmp$IB_Critic_C2, 
                           tmp$IB_Critic_C3, 
                           tmp$IB_Critic_C4_Incong, 
                           tmp$IB_Critic_C4_Cong, 
                           tmp$IB_Critic_C5, 
                           tmp$IB_Critic_C6, 
                           tmp$IB_Critic_C7, 
                           tmp$IB_Critic_C8)


 # Build a unique column that contain the detection of the unexpected element in the divided attention trial for all conditions
tmp$IB_Divided <- coalesce2(tmp$IB_Divided_C1, 
                            tmp$IB_Divided_C2, 
                            tmp$IB_Divided_C3, 
                            tmp$IB_Divided_C4_Incong, 
                            tmp$IB_Divided_C4_Cong, 
                            tmp$IB_Divided_C5, 
                            tmp$IB_Divided_C6, 
                            tmp$IB_Divided_C7, 
                            tmp$IB_Divided_C8)


 # Build a unique column that contain the detection of the unexpected element in the full attention trial for all conditions
tmp$IB_Full <- coalesce2(tmp$IB_Full_C1, 
                         tmp$IB_Full_C2, 
                         tmp$IB_Full_C3, 
                         tmp$IB_Full_C4_Incong, 
                         tmp$IB_Full_C4_Cong, 
                         tmp$IB_Full_C5, 
                         tmp$IB_Full_C6, 
                         tmp$IB_Full_C7, 
                         tmp$IB_Full_C8)


 # Build a unique column that contain the selected feature of the unexpected element in the critical trial for all conditions
tmp$Feature_Critic <- coalesce2(tmp$Feature_Critic_C1, 
                                tmp$Feature_Critic_C2, 
                                tmp$Feature_Critic_C3, 
                                tmp$Feature_Critic_C4_Incong, 
                                tmp$Feature_Critic_C4_Cong, 
                                tmp$Feature_Critic_C5, 
                                tmp$Feature_Critic_C6, 
                                tmp$Feature_Critic_C7, 
                                tmp$Feature_Critic_C8)

 # Build a unique column that contain the selected color of the unexpected element in the critical trial for all conditions
tmp$Color_Critic <- coalesce2(tmp$Color_Critic_C1, 
                              tmp$Color_Critic_C2, 
                              tmp$Color_Critic_C3, 
                              tmp$Color_Critic_C4_Incong, 
                              tmp$Color_Critic_C4_Cong, 
                              tmp$Color_Critic_C5, 
                              tmp$Color_Critic_C6, 
                              tmp$Color_Critic_C7, 
                              tmp$Color_Critic_C8)

 # Build a unique column that contain the selected motion of the unexpected element in the critical trial for all conditions
tmp$Motion_Critic <- coalesce2(tmp$Motion_Critic_C1, 
                               tmp$Motion_Critic_C2, 
                               tmp$Motion_Critic_C3, 
                               tmp$Motion_Critic_C4_Incong, 
                               tmp$Motion_Critic_C4_Cong, 
                               tmp$Motion_Critic_C5, 
                               tmp$Motion_Critic_C6, 
                               tmp$Motion_Critic_C7, 
                               tmp$Motion_Critic_C8)


 # Build a unique column that contain the selected feature of the unexpected element in the Divided attention trial for all conditions
tmp$Feature_Divided <- coalesce2(tmp$Feature_Divided_C1, 
                                 tmp$Feature_Divided_C2, 
                                 tmp$Feature_Divided_C3, 
                                 tmp$Feature_Divided_C4_Incong, 
                                 tmp$Feature_Divided_C4_Cong, 
                                 tmp$Feature_Divided_C5, 
                                 tmp$Feature_Divided_C6, 
                                 tmp$Feature_Divided_C7, 
                                 tmp$Feature_Divided_C8)

 # Build a unique column that contain the selected color of the unexpected element in the Divided attention trial for all conditions
tmp$Color_Divided <- coalesce2(tmp$Color_Divided_C1, 
                               tmp$Color_Divided_C2, 
                               tmp$Color_Divided_C3, 
                               tmp$Color_Divided_C4_Incong, 
                               tmp$Color_Divided_C4_Cong, 
                               tmp$Color_Divided_C5, 
                               tmp$Color_Divided_C6, 
                               tmp$Color_Divided_C7, 
                               tmp$Color_Divided_C8)

 # Build a unique column that contain the selected motion of the unexpected element in the Divided attention trial for all conditions
tmp$Motion_Divided <- coalesce2(tmp$Motion_Divided_C1, 
                                tmp$Motion_Divided_C2, 
                                tmp$Motion_Divided_C3, 
                                tmp$Motion_Divided_C4_Incong, 
                                tmp$Motion_Divided_C4_Cong, 
                                tmp$Motion_Divided_C5, 
                                tmp$Motion_Divided_C6, 
                                tmp$Motion_Divided_C7, 
                                tmp$Motion_Divided_C8)


 # Build a unique column that contain the selected feature of the unexpected element in the Full attention trial for all conditions
tmp$Feature_Full <- coalesce2(tmp$Feature_Full_C1, 
                              tmp$Feature_Full_C2, 
                              tmp$Feature_Full_C3, 
                              tmp$Feature_Full_C4_Incong, 
                              tmp$Feature_Full_C4_Cong, 
                              tmp$Feature_Full_C5, 
                              tmp$Feature_Full_C6, 
                              tmp$Feature_Full_C7, 
                              tmp$Feature_Full_C8)

 # Build a unique column that contain the selected color of the unexpected element in the Full attention trial for all conditions
tmp$Color_Full <- coalesce2(tmp$Color_Full_C1, 
                            tmp$Color_Full_C2, 
                            tmp$Color_Full_C3, 
                            tmp$Color_Full_C4_Incong, 
                            tmp$Color_Full_C4_Cong, 
                            tmp$Color_Full_C5, 
                            tmp$Color_Full_C6, 
                            tmp$Color_Full_C7, 
                            tmp$Color_Full_C8)

 # Build a unique column that contain the selected motion of the unexpected element in the Full attention trial for all conditions
tmp$Motion_Full <- coalesce2(tmp$Motion_Full_C1, 
                             tmp$Motion_Full_C2, 
                             tmp$Motion_Full_C3, 
                             tmp$Motion_Full_C4_Incong, 
                             tmp$Motion_Full_C4_Cong, 
                             tmp$Motion_Full_C5, 
                             tmp$Motion_Full_C6, 
                             tmp$Motion_Full_C7, 
                             tmp$Motion_Full_C8)


df <- tmp
remove(tmp)

```

 # Remove old columns 
(with lots of NA values)

```{r}

tmp <- df

tmp <- tmp %>% 
  select(participant:Chooserandom_Condition, Angry:Gender, TIME_total:Motion_Full)

df <- tmp 
remove(tmp)

```

 # Validity of noticing  
Here, We want to check if participants tell they notice an extra-object stimulus only when they really see it. 
For that, for participant who report seeing something on the critical trial, we check if they are able to report at least one caracteristic of this unexpected element (Feature, Color, Motion)

```{r Noticing_Check}

tmp <- df

 # Check noticing validity on the Critical trial
tmp <- tmp %>%
  mutate(Noticing_Critic = case_when((IB_Critic == 1 & Chooserandom_Instruction == 1)&(Feature_Critic == 3 | Motion_Critic == 2 | Color_Critic == 4) ~ 1, 
                                     (IB_Critic == 1 & Chooserandom_Instruction == 2)&(Feature_Critic == 3 | Motion_Critic == 2 | Color_Critic == 4) ~ 1,
                                     TRUE ~ 0))


 # Check noticing validity on the divided attention trial
tmp <- tmp %>%
  mutate(Noticing_Divided = case_when((IB_Divided == 1 & Chooserandom_Instruction == 1)&(Feature_Divided == 3 | Motion_Divided == 2 | Color_Divided == 4) ~ 1, 
                                      (IB_Divided == 1 & Chooserandom_Instruction == 2)&(Feature_Divided == 3 | Motion_Divided == 2 | Color_Divided == 4) ~ 1,
                                      TRUE ~ 0))


 # Check noticing validity on the full attention trial
tmp <- tmp %>%
  mutate(Noticing_Full = case_when((IB_Full == 1 & Chooserandom_Instruction == 1)&(Feature_Full == 3 | Motion_Full == 2 | Color_Full == 4) ~ 1, 
                                     (IB_Full == 1 & Chooserandom_Instruction == 2)&(Feature_Full == 3 | Motion_Full == 2 | Color_Full == 4) ~ 1,
                                     TRUE ~ 0))

warning("This checking make little differences in comparison to taking into account only the noticing self-report. It leads to an increasing in non-noticers number but it could be interesting to add some scripts in order to quantify this increasing")


df <- tmp
rm(tmp)

```

 # Accuracy on bounce counting 
Here, for each condition, we measure the performance on bounce counting for each participant per trial.
We also add a global accuracy score which is the mean of the trials : 2, 3, 4, critic and divided (Trial 1 is not included since we consider it as a training trial + Full attention trial is also not included since participants don't count bounces during this last trial)


```{r Bounce counting Accuracy}

tmp <- df

tmp <- tmp %>% 
  mutate(Error_Trial1 = case_when((Chooserandom_Instruction==2 & Chooserandom_Condition==1)~ abs(Count_Trial1-6),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==1)~ abs(Count_Trial1-5),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==2)~ abs(Count_Trial1-11),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==2)~ abs(Count_Trial1-10),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==3)~ abs(Count_Trial1-16),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==3)~ abs(Count_Trial1-17),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==41)~ abs(Count_Trial1-19),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==41)~ abs(Count_Trial1-22),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==42)~ abs(Count_Trial1-19),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==42)~ abs(Count_Trial1-22),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==5)~ abs(Count_Trial1-27),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==5)~ abs(Count_Trial1-24),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==6)~ abs(Count_Trial1-32),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==6)~ abs(Count_Trial1-32),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==7)~ abs(Count_Trial1-36),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==7)~ abs(Count_Trial1-38),
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==8)~ abs(Count_Trial1-41),
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==8)~ abs(Count_Trial1-46))) %>% 
  
  mutate(ErrorRate_Trial1 = case_when((Chooserandom_Instruction==2 & Chooserandom_Condition==1)~ abs(Count_Trial1-6)/6,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==1)~ abs(Count_Trial1-5)/5,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==2)~ abs(Count_Trial1-11)/11,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==2)~ abs(Count_Trial1-10)/10,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==3)~ abs(Count_Trial1-16)/16,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==3)~ abs(Count_Trial1-17)/17,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==41)~ abs(Count_Trial1-19)/19,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==41)~ abs(Count_Trial1-22)/22,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==42)~ abs(Count_Trial1-19)/19,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==42)~ abs(Count_Trial1-22)/22,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==5)~ abs(Count_Trial1-27)/27,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==5)~ abs(Count_Trial1-24)/24,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==6)~ abs(Count_Trial1-32)/32,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==6)~ abs(Count_Trial1-32)/32,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==7)~ abs(Count_Trial1-36)/36,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==7)~ abs(Count_Trial1-38)/38,
                                  (Chooserandom_Instruction==2 & Chooserandom_Condition==8)~ abs(Count_Trial1-41)/41,
                                  (Chooserandom_Instruction==1 & Chooserandom_Condition==8)~ abs(Count_Trial1-46)/46))


warning("In this part, I do not calculate the error and error rates for trial 2, trial 3, trial critic, trial 4, and trial divided. The number of bounces counting are listed in a notebook")

df <- tmp
rm(tmp)

```


# Calculation of an anxiety factorial score
Here we want to calculate a factorial score for each participant based on the five items of anxiety feelings during the experiment

```{r Anxiety factorial Score}
tmp <- df

# Check if it is possible to agregate theses five measure (anxious, nervous, calm, tense, stressed) in an unique factor : 
dt1_Factor<- tmp %>%
  select(Angry, Calm, Anxious, Nervous, Happy, Tense, Stressed, Depressed)%>%
  na.omit()

 # Check the factorial distribution of these 8 items
EFA_dt1 <- factanal(dt1_Factor, factors=1, rotation = "promax") 
print(EFA_dt1, digits = 2, cutoff = .2)
rm(dt1_Factor,EFA_dt1)
## In this experiment, loading of "Calm" item is .54 with other items. However, we decided not to agregate it with other items in order to preserve some consistency with other experiments
# Moreover, items "angry" and "depressed" load with the anxiety factor but to a lesser degree, so we decided not to aggregate these items in our factorial score  according to our preregistration

 # "Calm" item is an inverted one, so, we have to reverse it
tmp <- tmp %>%
  mutate(Calm_Recod = (8 - Calm))

## Now we calculate a factorial score from these 4 measure of stress
 # Build a data frame that only contain column of interest in this analysis
dt2_Factor <- tmp %>%
  select(Anxious, Nervous, Tense, Stressed)

FactorialScore <- fa(dt2_Factor, nfactors=1, rotate = "promax", scores = "Bartlett")
# Assign a threat score to each ppt calculated on the 4 measures of stress
tmp$FearScore<-FactorialScore$scores 
tmp$FearScore <- as.numeric(tmp$FearScore)


 # Calculating a mean rather than a factorial score
tmp <- tmp %>% 
  mutate(FearMean = rowMeans(select(tmp,c(Anxious, Nervous, Stressed, Tense))))

 # Calculate the correlation between the factorial or the mean score of each participant on these 5 items
cor.test(tmp$FearScore,tmp$FearMean)
 # The correlation is really high, so, according to or pre-registration, we use the factorial score rather than the mean on these 4 items

df <- tmp

rm(list=setdiff(ls(), c("df"))) # clear workspace except the data frame
```



```{r Adding_Variables}

tmp <- df


tmp <- tmp %>%
  mutate(PrimaryTask_str = case_when(Chooserandom_Instruction == 1 ~ "WhiteFocus", 
                                 Chooserandom_Instruction == 2 ~ "BlackFocus")) %>%
  mutate(PrimaryTask_C = case_when(Chooserandom_Instruction == 1 ~ -0.5, 
                                   Chooserandom_Instruction == 2 ~ +0.5)) %>%
  select(-Chooserandom_Instruction)


tmp <- tmp %>%
  mutate(Congruency_str = case_when(Chooserandom_Condition == 1 | Chooserandom_Condition == 2 | Chooserandom_Condition == 3 | Chooserandom_Condition == 41 ~ "Incongruent", 
                                Chooserandom_Condition == 42 | Chooserandom_Condition == 5 | Chooserandom_Condition == 6 | Chooserandom_Condition == 7 | Chooserandom_Condition == 8 ~ "Congruent")) %>%
  mutate(Congruency_C = case_when(Chooserandom_Condition == 1 | Chooserandom_Condition == 2 | Chooserandom_Condition == 3 | Chooserandom_Condition == 41 ~ -0.5, 
                                Chooserandom_Condition == 42 | Chooserandom_Condition == 5 | Chooserandom_Condition == 6 | Chooserandom_Condition == 7 | Chooserandom_Condition == 8 ~ +0.5)) 

tmp <- tmp %>%
  mutate(Load_C = case_when(Chooserandom_Condition == 1 ~ 1, 
                            Chooserandom_Condition == 2 ~ 2,
                            Chooserandom_Condition == 3 ~ 3,
                            Chooserandom_Condition == 41 ~ 4,
                            Chooserandom_Condition == 42 ~ 4,
                            Chooserandom_Condition == 5 ~ 5,
                            Chooserandom_Condition == 6 ~ 6,
                            Chooserandom_Condition == 7 ~ 7,
                            Chooserandom_Condition == 8 ~ 8)) %>%
  mutate(Load_str = case_when(Chooserandom_Condition == 1 ~ "One", 
                              Chooserandom_Condition == 2 ~ "Two",
                              Chooserandom_Condition == 3 ~ "Three",
                              Chooserandom_Condition == 41 ~ "Four_Incong",
                              Chooserandom_Condition == 42 ~ "Four_Cong",
                              Chooserandom_Condition == 5 ~ "Five",
                              Chooserandom_Condition == 6 ~ "Six",
                              Chooserandom_Condition == 7 ~ "Seven",
                              Chooserandom_Condition == 8 ~ "Eight")) %>%
  select(-Chooserandom_Condition)


tmp <- tmp %>%
  mutate(VisionPb = case_when(Vision_1 == 1 ~ -0.5, 
                              Vision_1 == 2 ~ +0.5)) %>%
  mutate(VisionPb_str = case_when(Vision_1 == 1 ~ "No", 
                                  Vision_1 == 2 ~ "Yes")) %>%
  select(-Vision_1) %>%
  
  
  mutate(Knew = case_when(Connaissance_1 == 1 ~ -0.5, 
                          Connaissance_1 == 2 ~ 0.5), 
         Knew_str = case_when(Connaissance_1 == 1 ~ "No", 
                              Connaissance_1 == 2 ~ "Yes")) %>%
  
  mutate(KnewTask = case_when(Connaissance_Task_1 == 1 ~ -0.5, 
                              Connaissance_Task_1 == 2 ~ 0.5),
         KnewTask_str = case_when(Connaissance_Task_1 == 1 ~ "No", 
                                  Connaissance_Task_1 == 2 ~ "Yes")) %>%
  
  mutate(KnewIB = case_when(Connaissance_IB_1 == 1 ~ -0.5, 
                            Connaissance_IB_1 == 2 ~ 0.5),
         KnewIB_str = case_when(Connaissance_IB_1 == 1 ~ "No", 
                                Connaissance_IB_1 == 2 ~ "Yes")) %>%
  select(-c(Connaissance_1, Connaissance_Task_1, Connaissance_IB_1))


tmp <- tmp %>%
  mutate(Gender_str = case_when(Gender == 1 ~ "Woman", 
                            Gender == 2 ~ "Man",
                            Gender == 3 ~ "NoBinary" ))

df <- tmp
rm(list=setdiff(ls(), c("df"))) # clear workspace except the data frame


```


```{r Reorganise dataframe}

df <- df %>%
  mutate(Study_Name = "IB_Load")

# A dataframe for the Threat X Congruency project
df_Final <- df %>% 
  select(Study_Name, response_id, participant, TIME_total, 
         Age, Gender, Gender_str, VisionPb_str, VisionPb,
         Knew, Knew_str, KnewTask, KnewTask_str, KnewIB, KnewIB_str,
         PrimaryTask_str, PrimaryTask_C, Congruency_str, Congruency_C, Load_str, Load_C,
         
         Count_Trial1, Count_Trial2, Count_Trial3, Count_Trial4, Count_TrialCritical, Count_TrialDivided,
         Error_Trial1, 
         ErrorRate_Trial1,
         
         IB_Critic:Motion_Full,
         Noticing_Critic, Noticing_Divided, Noticing_Full, 
         
         Angry, Happy, Depressed, Calm, Calm_Recod, Nervous, Anxious, Tense, Stressed,
         FearScore, FearMean, 
         )

```


```{r save datframes}

write.csv(df, file = "Transformed_Data/Dataset_AllVariables_IB_Load.csv")

write.csv(df_Final, file = "Transformed_Data/Dataset_Final_IB_Load.csv")


```


